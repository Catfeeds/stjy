<form method="post" id="form" action="#">    <div class="panel one-box">        <div class="table-responsive">            <table id="table" class="table table-hover table-bordered table-condensed">                <caption align="top">2017年09月华景分校市场部工资表</caption>                <input type="hidden" name="qishu" value="{$qishu}">                <input type="hidden" name="sid" value="{$sid}">                <input type="hidden" name="url" value="http://<?php echo $_SERVER['SERVER_NAME'].'/index.php/WagesScb/save' ; ?>">                <thead>                <tr >                    <volist name="table" id="t">                        <if condition="$t.beizhu eq '课程及业绩'">                        <volist name="kecheng" id="ke">                            <th style="background:yellow;">{$ke.name}<?php echo "(".($ke['ticheng']*100)."%)" ?></th>                        </volist>                            <else/>                            <?php                                if(!strstr($t['beizhu'],"0-")){                                    echo "<th>".$t['beizhu']."</th>";                                }                            ?>                        </if>                    </volist>                </tr>                </thead>                <tbody>                <foreach name="list" key="k" item="vo">                    <tr>                    <volist name="table" id="t">                        <if condition="$t.beizhu eq '课程及业绩'">                            <volist name="kecheng" id="ke">                                <td data-type="yeji" data-field="{$ke['name']}" style="background:yellow;"><?php                                if(!empty($vo['kechengyj'][$ke['name']])){                                    echo $vo['kechengyj'][$ke['name']];                                }else{                                    echo 0;                                }?></td>                            </volist>                            <else/>                            <?php                                if(!strstr($t['beizhu'],"0-")){                                    echo "<td data-type=\"field\" data-field='".$t['fieldname']."' data-value='' title='姓名：".$vo['xingming']['value']."，列名：".$t['beizhu']."'>".$vo[$t['fieldname']]['value']."</td>";                            }                            ?>                        </if>                    </volist>                    </tr>                </foreach>                </tbody>            </table>        </div>    </div></form><br/><button class="button bg-red button-larger btn_save_even">保存</button><style>    body {        overflow-x: scroll;        background-color: #fff;        width: 8000px;    }    .kecheng_bg{        background:yellow;!important;    }    .do_enter{        border-color: blue;    }    td{        text-align: center;    }</style><script type="text/javascript">    jisuan();    $(".do_enter").focus(function () {        $(this).select()    })    $(".do_enter").keyup(function () {        jisuan();    })        function jisuan() {        var list = $("#table tbody").find('tr');        $.each(list,function (i,e) {            var xuexikajs = parseFloat($(this).find("td[data-field='xuexikajs']").text());            var jixiaojj = parseFloat($(this).find("td[data-field='jixiaojj']").text());            var xiaozhangtdtc = parseFloat($(this).find("td[data-field='xiaozhangtdtc']").text());            var tuanduiwd = parseFloat($(this).find("input[name='tuanduiwd']").val());            var dituijrtjx = parseFloat($(this).find("input[name='dituijrtjx']").val());            var weixinjx = parseFloat($(this).find("input[name='weixinjx']").val());            var jiazhanghuixcbjl = parseFloat($(this).find("input[name='jiazhanghuixcbjl']").val());            var liushijtfjxjs = parseFloat($(this).find("td[data-field='liushijtfjxjs']").text());            var weijinbankhjx = parseFloat($(this).find("input[name='weijinbankhjx']").val());            var jidizskjx = parseFloat($(this).find("input[name='jidizskjx']").val());            var canzhaobdx = parseFloat($(this).find("input[name='canzhaobdx']").val());            var fudonghj = (xuexikajs + jixiaojj + xiaozhangtdtc + tuanduiwd + dituijrtjx + weixinjx + jiazhanghuixcbjl + liushijtfjxjs + weijinbankhjx + jidizskjx).toFixed(2);           $(this).find("td[data-field='fudonghj']").text(fudonghj);           if(fudonghj > canzhaobdx){               var benyuebf = 0;               var yingfagzhj = fudonghj;           }else {               var benyuebf = canzhaobdx - fudonghj;               var yingfagzhj = canzhaobdx;           }           $(this).find("td[data-field='benyuebf']").text(benyuebf);           $(this).find("td[data-field='yingfagzhj']").text(yingfagzhj);           var gongjijin = parseFloat($(this).find("td[data-field='gongjijin']").text());           var gerensb = parseFloat($(this).find("td[data-field='gerensb']").text());           var gongzi = (yingfagzhj - gongjijin - gerensb).toFixed(2);           var gerensds = geshui(gongzi);           $(this).find("td[data-field='gerensds']").text(gerensds);           var shifagzhj = (yingfagzhj - gongjijin - gerensb - gerensds).toFixed(2);           $(this).find("td[data-field='shifagzhj']").text(shifagzhj);        });    }    function save_data(){        var list = $("#table tbody").find('tr');        var qishu = $("input[name='qishu']").val();        var sid = $("input[name='sid']").val();        var url = $("input[name='url']").val();        var arr = "[";        $.each(list,function (i,e) {            var tr = "{";            var tds = $(this).find("td");            var kechengyeji = '"kechengyeji":{';            $.each(tds,function (m,n) {                if($(this).data("type") == 'field'){                    var f = $(this).data("field");                    if(f == undefined){                        return true;                    }                    if($(this).find("input").val() == undefined){                        var v = $(this).text();                    }else {                        var v = $(this).find("input").val();                    }                    tr += "\""+f+"\""+":\""+v+"\",";                }else {                    var f = $(this).data("field");                    if(f == undefined){                        return true;                    }                    var v = $(this).text();                    if(v == undefined){                        return true;                    }                    kechengyeji += "\""+f+"\""+":\""+v+"\",";                }            })            if(kechengyeji != ''){                kechengyeji = kechengyeji.substr(0,kechengyeji.length-1);            }            kechengyeji += "}";            tr += kechengyeji+"}";            arr += tr+",";        })        arr = arr.substr(0,arr.length-1);        arr += "]";        $.post(url,{'arr':arr,'qishu':qishu,'sid':sid},function(data){            if(data){                layer.msg('保存成功', {icon: 1});            }else {                layer.msg('保存失败', {icon: 2});            }        });//        console.log(arr);    };    $(".btn_save_even").click(function () {        save_data();    })    function geshui(gongzi) {        var shouru = parseFloat(gongzi) - 3500;        var gesui = 0;        if(shouru <= 1500){            gesui = shouru*0.03;        }        if(shouru > 1500 && shouru <= 4500){            gesui = shouru*0.1 - 105;        }        if(shouru > 4500 && shouru <= 9000){            gesui = shouru*0.2 - 555;        }        if(shouru > 9000 && shouru <= 35000){            gesui = shouru*0.25 - 1005;        }        if(shouru > 35000 && shouru <= 55000){            gesui = shouru*0.3 - 2755;        }        if(shouru > 55000 && shouru <= 80000){            gesui = shouru*0.35 - 5505;        }        if(shouru > 80000){            gesui = shouru*0.45 - 13505;        }        if(gesui < 0){            gesui = 0;        }        return gesui.toFixed(2);    }</script>