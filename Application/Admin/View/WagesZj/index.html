<form method="post" id="form" action="#">    <div class="panel one-box">        <div class="table-responsive">            <table id="table" class="table table-hover table-bordered table-condensed">                <caption align="top">2017年09月华景分校教学部工资表</caption>                <input type="hidden" name="qishu" value="{$qishu}">                <input type="hidden" name="sid" value="{$sid}">                <thead>                <tr >                    <volist name="table" id="t">                        <?php                                if(!strstr($t['beizhu'],"0-")){                                    echo "<th>".$t['beizhu']."</th>";                        }                        ?>                    </volist>                </tr>                </thead>                <tbody>                <foreach name="list" key="k" item="vo">                    <tr>                    <volist name="table" id="t">                        <?php                                if(!strstr($t['beizhu'],"0-")){                                    echo "<td data-type=\"field\" data-field='".$t['fieldname']."' data-value='' title='姓名：".$vo['xingming']['value']."，列名：".$t['beizhu']."'>".$vo[$t['fieldname']]['value']."</td>";                        }                        ?>                    </volist>                    </tr>                </foreach>                </tbody>            </table>        </div>    </div></form><br/><button class="button bg-red button-larger btn_save_even">保存</button><style>    body {        overflow-x: scroll;        background-color: #fff;        width: 8000px;    }    .kecheng_bg{        background:yellow;!important;    }    .do_enter{        border-color: blue;    }    td{        text-align: center;    }</style><script type="text/javascript">    jisuan();    $(".do_enter").focus(function () {        $(this).select()    })    $(".do_enter").keyup(function () {        jisuan();    })        function jisuan() {        var list = $("#table tbody").find('tr');        $.each(list,function (i,e) {//            var amibaqrsr = parseFloat($(this).find("td[data-field='amibaqrsr']").text());            var amibaqrsr = parseFloat($(this).find("input[name='amibaqrsr']").val());            var amitcbl = parseFloat($(this).find("input[name='amitcbl']").val());            var amibafc2 = (amibaqrsr*amitcbl).toFixed(2);            $(this).find("td[data-field='amibafc2']").text(amibafc2);            var zplzrs = parseFloat($(this).find("input[name='zplzrs']").val());            var banjipjrs = parseFloat($(this).find("input[name='banjipjrs']").val());            var xufeilvrtkf = parseFloat($(this).find("input[name='xufeilvrtkf']").val());            var gerenxsj = parseFloat($(this).find("input[name='gerenxsj']").val());            var kaohegrxfl = parseFloat($(this).find("input[name='kaohegrxfl']").val());            var kaohetdxf = parseFloat($(this).find("input[name='kaohetdxf']").val());            var gangweifc = parseFloat($(this).find("input[name='gangweifc']").val());            var liushijtfjxjs = parseFloat($(this).find("td[data-field='liushijtfjxjs']").text());            var jixiaojj = parseFloat($(this).find("input[name='jixiaojj']").val());            var scfy = parseFloat($(this).find("input[name='scfy']").val());            var kaoqin = parseFloat($(this).find("input[name='kaoqin']").val());            var dianhuacc = parseFloat($(this).find("input[name='dianhuacc']").val());            var jiabanfei = parseFloat($(this).find("input[name='jiabanfei']").val());            var zengsongke = parseFloat($(this).find("input[name='zengsongke']").val());            var jidizskjx = parseFloat($(this).find("input[name='jidizskjx']").val());            var koufajl = parseFloat($(this).find("input[name='koufajl']").val());            var fudonghj = (zplzrs + banjipjrs + xufeilvrtkf + xufeilvrtkf + gerenxsj + kaohegrxfl + kaohetdxf + gangweifc - liushijtfjxjs + jixiaojj + scfy + kaoqin + dianhuacc + jiabanfei + zengsongke + jidizskjx + koufajl).toFixed(2);            $(this).find("td[data-field='fudonghj']").text(fudonghj);            var suzhijj = parseFloat($(this).find("input[name='suzhijj']").val());            var lizhibc = parseFloat($(this).find("input[name='lizhibc']").val());            var butiehj = (suzhijj + lizhibc).toFixed(2);            $(this).find("td[data-field='butiehj']").text(butiehj);            var yingfagzhj = (parseFloat(amibafc2) + parseFloat(fudonghj) + parseFloat(butiehj)).toFixed(2);            $(this).find("td[data-field='yingfagzhj']").text(yingfagzhj);            var gongjijin = parseFloat($(this).find("td[data-field='gongjijin']").text());            var gerensb = parseFloat($(this).find("td[data-field='gerensb']").text());           var gongzi = (yingfagzhj - gongjijin - gerensb).toFixed(2);           var gerensds = geshui(gongzi);           $(this).find("td[data-field='gerensds']").text(gerensds);           var shifagzhj = (yingfagzhj - gongjijin - gerensb - gerensds).toFixed(2);           $(this).find("td[data-field='shifagzhj']").text(shifagzhj);        });    }    function save_data(){        var list = $("#table tbody").find('tr');        var qishu = $("input[name='qishu']").val();        var sid = $("input[name='sid']").val();        var arr = "[";        $.each(list,function (i,e) {            var tr = "{";            var tds = $(this).find("td");            $.each(tds,function (m,n) {                var f = $(this).data("field");                if(f == undefined){                    return true;                }                if($(this).find("input").val() == undefined){                    var v = $(this).text();                }else {                    var v = $(this).find("input").val();                }                tr += "\""+f+"\""+":\""+v+"\",";            })            tr = tr.substr(0,tr.length-1);            tr += "}";            arr += tr+",";        })        arr = arr.substr(0,arr.length-1);        arr += "]";        $.post('save',{'arr':arr,'qishu':qishu,'sid':sid},function(data){            if(data){                layer.msg('保存成功', {icon: 1});            }else {                layer.msg('保存失败', {icon: 2});            }        });//        console.log(arr);    };    $(".btn_save_even").click(function () {        save_data();    })    function geshui(gongzi) {        var shouru = parseFloat(gongzi) - 3500;        var gesui = 0;        if(shouru <= 1500){            gesui = shouru*0.03;        }        if(shouru > 1500 && shouru <= 4500){            gesui = shouru*0.1 - 105;        }        if(shouru > 4500 && shouru <= 9000){            gesui = shouru*0.2 - 555;        }        if(shouru > 9000 && shouru <= 35000){            gesui = shouru*0.25 - 1005;        }        if(shouru > 35000 && shouru <= 55000){            gesui = shouru*0.3 - 2755;        }        if(shouru > 55000 && shouru <= 80000){            gesui = shouru*0.35 - 5505;        }        if(shouru > 80000){            gesui = shouru*0.45 - 13505;        }        if(gesui < 0){            gesui = 0;        }        return gesui.toFixed(2);    }</script>