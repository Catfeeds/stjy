<form method="post" id="form" action="#">    <div class="panel one-box">        <div class="table-responsive">            <table id="table" class="table table-hover table-bordered table-condensed">                <caption align="top">2017年09月华景分校教学部工资表</caption>                <input type="hidden" name="qishu" value="{$qishu}">                <input type="hidden" name="sid" value="{$sid}">                <input type="hidden" name="url" value="http://<?php echo $_SERVER['SERVER_NAME'].'/index.php/WagesXzb/save' ; ?>">                <thead>                <tr >                    <volist name="table" id="t">                        <?php                                if(!strstr($t['beizhu'],"0-")){                                    echo "<th>".$t['beizhu']."</th>";                        }                        ?>                    </volist>                </tr>                </thead>                <tbody>                <foreach name="list" key="k" item="vo">                    <tr>                    <volist name="table" id="t">                        <?php                                if(!strstr($t['beizhu'],"0-")){                                    echo "<td data-type=\"field\" data-field='".$t['fieldname']."' data-value='' title='姓名：".$vo['xingming']['value']."，列名：".$t['beizhu']."'>".$vo[$t['fieldname']]['value']."</td>";                        }                        ?>                    </volist>                    </tr>                </foreach>                </tbody>            </table>        </div>    </div></form><br/><button class="button bg-red button-larger btn_save_even">保存</button><style>    body {        overflow-x: scroll;        background-color: #fff;        width: 9000px;    }    .kecheng_bg{        background:yellow;!important;    }    .do_enter{        border-color: blue;    }    td{        text-align: center;    }</style><script type="text/javascript">    jisuan();    $(".do_enter").focus(function () {        $(this).select()    })    $(".do_enter").keyup(function () {        jisuan();    })        function jisuan() {        var list = $("#table tbody").find('tr');        $.each(list,function (i,e) {//            var amibaqrsr = parseFloat($(this).find("td[data-field='amibaqrsr']").text());            var jibie = parseFloat($(this).find("input[name='peixunshijb']").val());            var zaiduxyrs = parseFloat($(this).find("td[data-field='zaiduxyrs']").text());            var zhehouzaiduxyrs = zaiduxyrs*jibie;            $(this).find("td[data-field='zhehouzaiduxyrs']").text(zhehouzaiduxyrs);            var zaidursdj = parseFloat($(this).find("td[data-field='zaidursdj']").text());            var zaiduxyfc = zhehouzaiduxyrs*zaidursdj;            $(this).find("td[data-field='zaiduxyfc']").text(zaiduxyfc);            var quanzhiygrs = parseFloat($(this).find("td[data-field='quanzhiygrs']").text());            var zhehouquanzhiygrs = quanzhiygrs*jibie;            $(this).find("td[data-field='zhehouquanzhiygrs']").text(zhehouquanzhiygrs);            var yuangongambdj = parseFloat($(this).find("td[data-field='yuangongambdj']").text());            var yuangongfc = zhehouquanzhiygrs*yuangongambdj;            $(this).find("td[data-field='yuangongfc']").text(yuangongfc);            var fenxiaomj = parseFloat($(this).find("td[data-field='fenxiaomj']").text());            var zhehoufenxiaomj = fenxiaomj*jibie;            $(this).find("td[data-field='zhehoufenxiaomj']").text(zhehoufenxiaomj);            var weishengaqambdj = parseFloat($(this).find("td[data-field='weishengaqambdj']").text());            var weishengglfc = zhehoufenxiaomj*weishengaqambdj;            $(this).find("td[data-field='weishengglfc']").text(weishengglfc);            var mianshixygrs =  parseFloat($(this).find("input[name='mianshixygrs']").val());            var zhehoumianshixygrs = mianshixygrs*jibie;            $(this).find("td[data-field='zhehoumianshixygrs']").text(zhehoumianshixygrs);            var zhaopinambdj = parseFloat($(this).find("td[data-field='zhaopinambdj']").text());            var mianshifc = zhehoumianshixygrs*zhaopinambdj;            $(this).find("td[data-field='mianshifc']").text(mianshifc);            var xinyuangongrzrs = parseFloat($(this).find("td[data-field='xinyuangongrzrs']").text());            var zhehouxinyuangongrzrs = xinyuangongrzrs*jibie;            $(this).find("td[data-field='zhehouxinyuangongrzrs']").text(zhehouxinyuangongrzrs);            var ruzhirsambdj = parseFloat($(this).find("td[data-field='ruzhirsambdj']").text());            var xinyuangongrzfc = zhehouxinyuangongrzrs*ruzhirsambdj;            $(this).find("td[data-field='xinyuangongrzfc']").text(xinyuangongrzfc);            var chukujcts =  parseFloat($(this).find("input[name='chukujcts']").val());            var zhehouchukujcts = chukujcts*jibie;            $(this).find("td[data-field='zhehouchukujcts']").text(zhehouchukujcts);            var cangkuglambdj = parseFloat($(this).find("td[data-field='cangkuglambdj']").text());            var xinyuangongrzfc2 = zhehouchukujcts*cangkuglambdj;            $(this).find("td[data-field='xinyuangongrzfc2']").text(xinyuangongrzfc2);            var benyuesfje =  parseFloat($(this).find("td[data-field='benyuesfje']").text());            var zhehoubenyuesfje = benyuesfje*jibie;            $(this).find("td[data-field='zhehoubenyuesfje']").text(zhehoubenyuesfje);            var shoufeiamb = parseFloat($(this).find("td[data-field='shoufeiamb']").text());            var shoufeifc = zhehoubenyuesfje*shoufeiamb;            $(this).find("td[data-field='shoufeifc']").text(shoufeifc);            var guanlizjs =  parseFloat($(this).find("input[name='guanlizjs']").val());            var zhehouguanlizjs = guanlizjs*jibie;            $(this).find("td[data-field='zhehouguanlizjs']").text(zhehouguanlizjs);            var zhengjianglambdj = parseFloat($(this).find("td[data-field='zhengjianglambdj']").text());            var zhengjianglfc = zhehouguanlizjs*zhengjianglambdj;            $(this).find("td[data-field='zhengjianglfc']").text(zhengjianglfc);            var zongfencheng = (zaiduxyfc + yuangongfc + weishengglfc + mianshifc + shoufeifc + zhengjianglfc).toFixed(2);            $(this).find("td[data-field='zongfencheng']").text(zongfencheng);            var gudingxc = parseFloat($(this).find("input[name='amitcbl']").val());            var liushijtfjxjs = parseFloat($(this).find("td[data-field='liushijtfjxjs']").text());            var jixiaojj = parseFloat($(this).find("input[name='jixiaojj']").val());            var shichangfy = parseFloat($(this).find("input[name='shichangfy']").val());            var kaoqin = parseFloat($(this).find("input[name='kaoqin']").val());            var dianhuacc = parseFloat($(this).find("input[name='dianhuacc']").val());            var jiabanfei = parseFloat($(this).find("input[name='jiabanfei']").val());            var zengsongke = parseFloat($(this).find("input[name='zengsongke']").val());            var jidizskjx = parseFloat($(this).find("input[name='jidizskjx']").val());            var koufajl = parseFloat($(this).find("input[name='koufajl']").val());            var fudonghj = (zongfencheng + gudingxc - parseFloat(liushijtfjxjs) + jixiaojj + shichangfy + kaoqin + dianhuacc + jiabanfei + zengsongke + jidizskjx + koufajl).toFixed(2);            $(this).find("td[data-field='fudonghj']").text(fudonghj);            var yingfagzhj = fudonghj;            $(this).find("td[data-field='yingfagzhj']").text(yingfagzhj);            $(this).find("td[data-field='yingfagzhj']").text(yingfagzhj);            var gongjijin = parseFloat($(this).find("td[data-field='gongjijin']").text());            var gerensb = parseFloat($(this).find("td[data-field='gerensb']").text());           var gongzi = (yingfagzhj - gongjijin - gerensb).toFixed(2);           var gerensds = geshui(gongzi);           $(this).find("td[data-field='gerensds']").text(gerensds);           var shifagzhj = (yingfagzhj - gongjijin - gerensb - gerensds).toFixed(2);           $(this).find("td[data-field='shifagzhj']").text(shifagzhj);        });    }    function save_data(){        var list = $("#table tbody").find('tr');        var qishu = $("input[name='qishu']").val();        var sid = $("input[name='sid']").val();        var url = $("input[name='url']").val();        var arr = "[";        $.each(list,function (i,e) {            var tr = "{";            var tds = $(this).find("td");            $.each(tds,function (m,n) {                var f = $(this).data("field");                if(f == undefined){                    return true;                }                if($(this).find("input").val() == undefined){                    var v = $(this).text();                }else {                    var v = $(this).find("input").val();                }                tr += "\""+f+"\""+":\""+v+"\",";            })            tr = tr.substr(0,tr.length-1);            tr += "}";            arr += tr+",";        })        arr = arr.substr(0,arr.length-1);        arr += "]";        $.post(url,{'arr':arr,'qishu':qishu,'sid':sid},function(data){            if(data){                layer.msg('保存成功', {icon: 1});            }else {                layer.msg('保存失败', {icon: 2});            }        });//        console.log(arr);    };    $(".btn_save_even").click(function () {        save_data();    })    function geshui(gongzi) {        var shouru = parseFloat(gongzi) - 3500;        var gesui = 0;        if(shouru <= 1500){            gesui = shouru*0.03;        }        if(shouru > 1500 && shouru <= 4500){            gesui = shouru*0.1 - 105;        }        if(shouru > 4500 && shouru <= 9000){            gesui = shouru*0.2 - 555;        }        if(shouru > 9000 && shouru <= 35000){            gesui = shouru*0.25 - 1005;        }        if(shouru > 35000 && shouru <= 55000){            gesui = shouru*0.3 - 2755;        }        if(shouru > 55000 && shouru <= 80000){            gesui = shouru*0.35 - 5505;        }        if(shouru > 80000){            gesui = shouru*0.45 - 13505;        }        if(gesui < 0){            gesui = 0;        }        return gesui.toFixed(2);    }</script>